{{ define "main" }}

<!-- é¡µé¢å¤´éƒ¨ -->
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900 dark:to-purple-900">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    
    <!-- é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
    <div class="text-center mb-16">
      <div class="relative inline-block">
        <!-- è£…é¥°æ€§èƒŒæ™¯ -->
        <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg blur opacity-25 animate-pulse"></div>
        <h1 class="relative bg-white dark:bg-gray-900 px-8 py-4 rounded-lg text-4xl md:text-5xl lg:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600">
          <svg class="inline-block w-12 h-12 md:w-16 md:h-16 mr-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
          </svg>
          æ ‡ç­¾äº‘
        </h1>
      </div>
      
      <p class="mt-6 text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto leading-relaxed">
        æ¢ç´¢æ–‡ç« æ ‡ç­¾ï¼Œå‘ç°æ„Ÿå…´è¶£çš„å†…å®¹ã€‚ç‚¹å‡»æ ‡ç­¾æŸ¥çœ‹ç›¸å…³æ–‡ç« ï¼Œä½¿ç”¨æœç´¢å¿«é€Ÿå®šä½ã€‚
      </p>
      
      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6 max-w-2xl mx-auto">
        <div class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">{{ len .Site.Taxonomies.tags }}</div>
          <div class="text-gray-600 dark:text-gray-300 mt-1">æ€»æ ‡ç­¾æ•°</div>
        </div>
        <div class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="text-3xl font-bold text-purple-600 dark:text-purple-400">
            {{- $totalPosts := 0 -}}
            {{- range .Site.Taxonomies.tags -}}
              {{- $totalPosts = add $totalPosts .Count -}}
            {{- end -}}
            {{ $totalPosts }}
          </div>
          <div class="text-gray-600 dark:text-gray-300 mt-1">æ ‡ç­¾æ–‡ç« æ•°</div>
        </div>
        <div class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="text-3xl font-bold text-indigo-600 dark:text-indigo-400">
            {{- $maxCount := 0 -}}
            {{- range .Site.Taxonomies.tags -}}
              {{- if gt .Count $maxCount -}}
                {{- $maxCount = .Count -}}
              {{- end -}}
            {{- end -}}
            {{ $maxCount }}
          </div>
          <div class="text-gray-600 dark:text-gray-300 mt-1">æœ€çƒ­æ ‡ç­¾æ•°</div>
        </div>
      </div>
    </div>

    <!-- æœç´¢å’Œè¿‡æ»¤åŒºåŸŸ -->
    <div class="mb-12">
      <div class="max-w-2xl mx-auto">
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
          <input 
            type="search" 
            id="tag-search"
            class="block w-full pl-12 pr-12 py-4 text-lg bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-2 border-gray-200 dark:border-gray-600 rounded-2xl text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-4 focus:ring-blue-500/25 focus:border-blue-500 dark:focus:border-blue-400 transition-all duration-300 shadow-lg"
            placeholder="æœç´¢æ ‡ç­¾..."
            autocomplete="off"
          >
          <div class="absolute inset-y-0 right-0 pr-4 flex items-center">
            <button 
              id="clear-search" 
              class="opacity-0 transition-opacity text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
            >
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- æœç´¢ç»“æœè®¡æ•° -->
        <div id="search-stats" class="mt-4 text-center text-gray-600 dark:text-gray-400 opacity-0 transition-opacity">
          <!-- æœç´¢ç»Ÿè®¡ -->
        </div>
      </div>
    </div>

    <!-- æ’åºé€‰é¡¹ -->
    <div class="mb-12">
      <div class="flex flex-wrap justify-center gap-4">
        <button 
          data-sort="name" 
          class="sort-btn active px-6 py-3 rounded-full text-sm font-medium transition-all duration-300 bg-blue-500 text-white shadow-lg hover:shadow-xl hover:scale-105"
        >
          <svg class="inline-block w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"></path>
          </svg>
          æŒ‰åç§°æ’åº
        </button>
        <button 
          data-sort="count" 
          class="sort-btn px-6 py-3 rounded-full text-sm font-medium transition-all duration-300 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300 dark:hover:border-blue-600 hover:scale-105"
        >
          <svg class="inline-block w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
          </svg>
          æŒ‰çƒ­åº¦æ’åº
        </button>
        <button 
          data-sort="recent" 
          class="sort-btn px-6 py-3 rounded-full text-sm font-medium transition-all duration-300 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300 dark:hover:border-blue-600 hover:scale-105"
        >
          <svg class="inline-block w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          æŒ‰æœ€æ–°ä½¿ç”¨
        </button>
      </div>
    </div>

    <!-- æ ‡ç­¾äº‘å±•ç¤ºåŒºåŸŸ -->
    <div class="mb-16">
      <div id="tags-container" class="flex flex-wrap justify-center gap-4">
        {{- range $name, $taxonomy := .Site.Taxonomies.tags }}
          {{- $count := .Count }}
          {{- $weight := div (mul $count 100) (len $.Site.RegularPages) }}
          {{- $size := cond (lt $weight 10) "small" (cond (lt $weight 30) "medium" "large") }}
          {{- $color := cond (eq $size "small") "blue" (cond (eq $size "medium") "purple" "indigo") }}
          
          <a 
            href="{{ "/tags/" | relURL }}{{ $name | urlize }}" 
            class="tag-item tag-{{ $size }} group relative inline-flex items-center px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 transform hover:scale-110 hover:rotate-1 hover:shadow-xl"
            data-tag="{{ $name }}"
            data-count="{{ $count }}"
            data-size="{{ $size }}"
            style="--tag-delay: {{ mod (len $name) 10 | mul 0.1 }}s;"
          >
            <!-- èƒŒæ™¯æ•ˆæœ -->
            <div class="absolute inset-0 bg-gradient-to-r from-{{ $color }}-400 to-{{ $color }}-600 rounded-full opacity-10 group-hover:opacity-20 transition-opacity"></div>
            <div class="absolute inset-0 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-full border border-{{ $color }}-200 dark:border-{{ $color }}-700 group-hover:border-{{ $color }}-300 dark:group-hover:border-{{ $color }}-600 transition-colors"></div>
            
            <!-- å›¾æ ‡ -->
            <svg class="relative w-4 h-4 mr-2 text-{{ $color }}-500 group-hover:text-{{ $color }}-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
            </svg>
            
            <!-- æ ‡ç­¾å -->
            <span class="relative text-gray-700 dark:text-gray-300 group-hover:text-{{ $color }}-700 dark:group-hover:text-{{ $color }}-300 transition-colors">
              {{ $name }}
            </span>
            
            <!-- æ–‡ç« æ•°é‡ -->
            <span class="relative ml-2 px-2 py-1 text-xs bg-{{ $color }}-100 dark:bg-{{ $color }}-900/50 text-{{ $color }}-700 dark:text-{{ $color }}-300 rounded-full group-hover:bg-{{ $color }}-200 dark:group-hover:bg-{{ $color }}-800/50 transition-colors">
              {{ $count }}
            </span>
            
            <!-- æ‚¬åœæ•ˆæœ -->
            <div class="absolute -inset-1 bg-gradient-to-r from-{{ $color }}-600 to-purple-600 rounded-full opacity-0 group-hover:opacity-20 blur-sm transition-opacity"></div>
          </a>
        {{- end }}
      </div>
      
      <!-- ç©ºçŠ¶æ€ -->
      <div id="empty-state" class="hidden text-center py-16">
        <div class="mb-6">
          <svg class="mx-auto h-24 w-24 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>
        <p class="text-xl text-gray-500 dark:text-gray-400 mb-4">æœªæ‰¾åˆ°åŒ¹é…çš„æ ‡ç­¾</p>
        <button 
          id="clear-all-filters" 
          class="px-6 py-3 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors shadow-lg hover:shadow-xl"
        >
          æ¸…é™¤æœç´¢
        </button>
      </div>
    </div>

    <!-- çƒ­é—¨æ ‡ç­¾æ¨è -->
    <div class="mt-16">
      <h2 class="text-3xl font-bold text-center mb-8 text-gray-900 dark:text-white">
        ğŸ”¥ çƒ­é—¨æ ‡ç­¾
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
        {{- $sortedTags := sort .Site.Taxonomies.tags "Count" "desc" }}
        {{- range first 6 $sortedTags }}
          {{- $tagName := .Page.Title }}
          {{- $tagCount := .Count }}
          {{- $tagURL := .Page.RelPermalink }}
          
          <div class="group bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-gray-200/50 dark:border-gray-700/50 hover:shadow-2xl hover:scale-105 transition-all duration-300">
            <a href="{{ $tagURL }}" class="block">
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                  <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                    </svg>
                  </div>
                  <div class="ml-4">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                      {{ $tagName }}
                    </h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">{{ $tagCount }} ç¯‡æ–‡ç« </p>
                  </div>
                </div>
                <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 group-hover:translate-x-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </div>
              
              <!-- æ–‡ç« é¢„è§ˆ -->
              <div class="space-y-2">
                {{- range first 3 .Pages }}
                  <div class="text-sm text-gray-600 dark:text-gray-400 truncate">
                    â€¢ {{ .Title }}
                  </div>
                {{- end }}
                {{- if gt .Count 3 }}
                  <div class="text-sm text-blue-600 dark:text-blue-400">
                    è¿˜æœ‰ {{ sub .Count 3 }} ç¯‡æ–‡ç« ...
                  </div>
                {{- end }}
              </div>
            </a>
          </div>
        {{- end }}
      </div>
    </div>
    
  </div>
</div>

<!-- æ ‡ç­¾é¡µé¢ä¸“ç”¨æ ·å¼å’Œè„šæœ¬ -->
<style>
/* æ ‡ç­¾å°ºå¯¸æ ·å¼ */
.tag-small {
  font-size: 0.875rem;
  padding: 0.5rem 0.75rem;
}

.tag-medium {
  font-size: 1rem;
  padding: 0.5rem 1rem;
}

.tag-large {
  font-size: 1.125rem;
  padding: 0.75rem 1.25rem;
}

/* å…¥åœºåŠ¨ç”» */
.tag-item {
  animation: tagFadeIn 0.8s ease-out forwards;
  animation-delay: var(--tag-delay);
  opacity: 0;
  transform: translateY(20px);
}

@keyframes tagFadeIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* æ‚¬åœåŠ¨ç”» */
.tag-item:hover {
  animation: tagBounce 0.6s ease-in-out;
}

@keyframes tagBounce {
  0%, 100% { transform: scale(1.1) rotate(1deg); }
  50% { transform: scale(1.15) rotate(-1deg); }
}

/* æœç´¢é«˜äº® */
.highlight-match {
  background: linear-gradient(120deg, #fbbf24 0%, #f59e0b 100%);
  color: #92400e;
  padding: 0.125rem 0.25rem;
  border-radius: 0.25rem;
  font-weight: 600;
}

.dark .highlight-match {
  background: linear-gradient(120deg, #f59e0b 0%, #d97706 100%);
  color: #fbbf24;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('tag-search');
  const clearSearchBtn = document.getElementById('clear-search');
  const clearAllBtn = document.getElementById('clear-all-filters');
  const searchStats = document.getElementById('search-stats');
  const tagsContainer = document.getElementById('tags-container');
  const emptyState = document.getElementById('empty-state');
  const sortBtns = document.querySelectorAll('.sort-btn');
  
  let allTags = Array.from(document.querySelectorAll('.tag-item'));
  let currentSort = 'name';
  
  // æœç´¢åŠŸèƒ½
  function performSearch(query) {
    const lowerQuery = query.toLowerCase().trim();
    let visibleCount = 0;
    
    allTags.forEach(tag => {
      const tagName = tag.dataset.tag.toLowerCase();
      const isVisible = !query || tagName.includes(lowerQuery);
      
      if (isVisible) {
        tag.style.display = 'inline-flex';
        highlightMatch(tag, lowerQuery);
        visibleCount++;
      } else {
        tag.style.display = 'none';
      }
    });
    
    // æ›´æ–°ç»Ÿè®¡
    updateSearchStats(query, visibleCount);
    
    // æ˜¾ç¤º/éšè—ç©ºçŠ¶æ€
    if (visibleCount === 0 && query) {
      tagsContainer.style.display = 'none';
      emptyState.style.display = 'block';
    } else {
      tagsContainer.style.display = 'flex';
      emptyState.style.display = 'none';
    }
    
    // æ›´æ–°æ¸…é™¤æŒ‰é’®
    if (query) {
      clearSearchBtn.style.opacity = '1';
    } else {
      clearSearchBtn.style.opacity = '0';
    }
  }
  
  function highlightMatch(tagElement, query) {
    const tagNameSpan = tagElement.querySelector('span:first-of-type');
    const originalText = tagElement.dataset.tag;
    
    if (!query) {
      tagNameSpan.innerHTML = originalText;
      return;
    }
    
    const regex = new RegExp(`(${escapeRegex(query)})`, 'gi');
    const highlightedText = originalText.replace(regex, '<span class="highlight-match">$1</span>');
    tagNameSpan.innerHTML = highlightedText;
  }
  
  function escapeRegex(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }
  
  function updateSearchStats(query, count) {
    if (query) {
      searchStats.textContent = `æ‰¾åˆ° ${count} ä¸ªåŒ…å« "${query}" çš„æ ‡ç­¾`;
      searchStats.style.opacity = '1';
    } else {
      searchStats.style.opacity = '0';
    }
  }
  
  // æ’åºåŠŸèƒ½
  function sortTags(method) {
    const container = document.getElementById('tags-container');
    
    allTags.sort((a, b) => {
      switch(method) {
        case 'count':
          return parseInt(b.dataset.count) - parseInt(a.dataset.count);
        case 'recent':
          // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…çš„æœ€è¿‘ä½¿ç”¨æ—¶é—´æ’åº
          // æš‚æ—¶æŒ‰æ–‡ç« æ•°é‡æ’åº
          return parseInt(b.dataset.count) - parseInt(a.dataset.count);
        default: // name
          return a.dataset.tag.localeCompare(b.dataset.tag, 'zh-CN');
      }
    });
    
    // é‡æ–°æ’åˆ—DOMå…ƒç´ 
    allTags.forEach(tag => container.appendChild(tag));
    
    // é‡æ–°åº”ç”¨åŠ¨ç”»
    allTags.forEach((tag, index) => {
      tag.style.setProperty('--tag-delay', `${index * 0.05}s`);
      tag.style.animation = 'none';
      tag.offsetHeight; // å¼ºåˆ¶é‡æ’
      tag.style.animation = 'tagFadeIn 0.3s ease-out forwards';
    });
  }
  
  // äº‹ä»¶ç›‘å¬
  searchInput.addEventListener('input', (e) => {
    performSearch(e.target.value);
  });
  
  clearSearchBtn.addEventListener('click', () => {
    searchInput.value = '';
    performSearch('');
    searchInput.focus();
  });
  
  clearAllBtn.addEventListener('click', () => {
    searchInput.value = '';
    performSearch('');
  });
  
  // æ’åºæŒ‰é’®äº‹ä»¶
  sortBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      sortBtns.forEach(b => {
        b.classList.remove('active', 'bg-blue-500', 'text-white', 'shadow-lg');
        b.classList.add('bg-white/80', 'dark:bg-gray-800/80', 'text-gray-700', 'dark:text-gray-300', 'border', 'border-gray-200', 'dark:border-gray-600');
      });
      
      btn.classList.add('active', 'bg-blue-500', 'text-white', 'shadow-lg');
      btn.classList.remove('bg-white/80', 'dark:bg-gray-800/80', 'text-gray-700', 'dark:text-gray-300', 'border', 'border-gray-200', 'dark:border-gray-600');
      
      currentSort = btn.dataset.sort;
      sortTags(currentSort);
    });
  });
  
  // é”®ç›˜å¿«æ·é”®
  document.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      searchInput.focus();
    }
    
    if (e.key === 'Escape' && document.activeElement === searchInput) {
      searchInput.blur();
      if (searchInput.value) {
        clearSearchBtn.click();
      }
    }
  });
  
  // åˆå§‹åŒ–
  sortTags(currentSort);
  
  console.log('æ ‡ç­¾é¡µé¢åŠŸèƒ½å·²åŠ è½½');
});
</script>

{{ end }}